import 'package:get/get.dart';
import '../models/level_model.dart';

class LevelController extends GetxController {
  // قائمة المستويات
  final RxList<Level> levels = <Level>[].obs;
  // المستوى المختار (id)
  final RxInt selectedLevel = 0.obs;
  // بحث النصوص
  final RxString searchQuery = ''.obs;
  final RxList<Textoo> searchResults = <Textoo>[].obs;

  @override
  void onInit() {
    super.onInit();
    loadLevels();
  }

  /// تحميل قائمة المستويات مع النصوص والكلمات المميزة
  void loadLevels() {
    levels.value = [
      // مستوى السنة الأولى
      Level(
        id: 1,
        name: 'السنة الأولى',
        image: 'assets/images/1.png',
        texts: [
          Textoo(
            id: 1,
            name: 'أصدقاء الكتابِ',
            image: 'assets/images/1_1_1.png',
            content: '''
غَصَّت أروِقَةُ المَعرِضِ بالزُّوَّارِ، فقد جاء أصدقاءُ الكتابِ من كُلِّ مكانٍ.
دَخَلَ سميرٌ وياسمينُ المَعرِضَ فَتِقَةً أَيدِيهِما، وراحَا يُرَكِّضانِ في كُلِّ اتجاهٍ، ناداهُما الأبُ: لا تبتعدَا كثيرًا.
هامَوا الوِرَاقَ المخصصَ لكُتُبِ الأطفَالِ.
قال البائعُ: هذا فَواسِينُ، وتِلكَ قِصَصٌ للمِظَلَّةِ، وهُناكَ دفاتِرُ للتّلوِينِ.
اشْتَرتْ ياسمينُ قصةً ودفترًا للتلوينِ، أمّا يَاسِمِيرُ فقَالَ: لقد تسَلَّيتُ كَثِيرًا، ولكِنْ لم أَجِدْ مَا أَبحَثُ عَنهُ. مَا اشترَيتَ شَيئًا؟ ثمَّ توقّفَت وأشارَت إِلى أَعلَى الرَّفِّ: هذَا الكِتَابُ الذي أَبحَثُ عنهُ، إنَّهُ القُرآنُ الكريمُ
''',
            highlightedWords: [
              HighlightedWord(
                word: 'غَصَّت',
                image: 'assets/images/words/1_1_1.jpg',
                description: 'امتلأت؛ مثال: غَصَّ الملعب بالمتفرجين.',
                audioPath: 'assets/audio/1_1.mp3',
              ),
              HighlightedWord(
                word: 'يُرَكِّضانِ',
                image: 'assets/images/words/1_1_2.jpg',
                description:
                    'يجريان بسرعة؛ مثال: يَرْكُضُ الحِصَانُ بِسُرْعَةٍ.',
                audioPath: 'assets/audio/1_1_2.mp3',
              ),
            ],
          ),
        ],
      ),

      // مستوى السنة الثانية
      Level(
        id: 2,
        name: 'السنة الثانية',
        image: 'assets/images/2.png',
        texts: [
          Textoo(
            id: 1,
            name: 'العودة إلى المدرسة',
            image: 'assets/images/2_1_1.jpg',
            content: '''
الْيَوْمَ نَعُودُ إِلَى الْمَدْرَسَةِ  
فِي هَذَا الصَّبَاحِ، أَيْقَظَتْنِي أُمِّي بَاكِرًا حَتَّى لاَ أَتَأَخَّرَ عَنْ مَوْعِدِ الدُّخُولِ إِلَى الْمَدْرَسَةِ.  
غَيَّرْتُ مَلابِسِي، وَارْتَدَيْتُ مِئْزَرِي، ثُمَّ أَخَذْتُ مِحْفَظَتِي الْجَدِيدَةَ، وَخَرَجْتُ مُسْرِعَةً.  
الأُمَّ: «حَذَارِ مِنْ أَخْطَارِ الطَّرِيقِ يَا لَيْلَى، اِمْشِي عَلَى الرَّصِيفِ ، وَلَا تَلْعَبِي فِي الطَّرِيقِ.»  
كَانَتْ صَدِيقَتِي مُنَى تَنْتَظِرُنِي أَمَامَ الْبَيْتِ، اِنْطَلَقْتُ مَعَهَا وَسَطَ جَمَاعَاتٍ مِنَ التَّلامِيذِ، وَكُلُّنَا فَرَحٌّ بِعَوْدَتِنَا إِلَى الْمَدْرَسَةِ الَّتِي اشْتَقْنَا إِلَيْهَا كَثِيرًا.
''',
            highlightedWords: [
              HighlightedWord(
                word: 'الرَّصِيفِ',
                image: 'assets/images/words/2_1_1.jpg',
                description:
                    'المساحة الجانبية بجانب الطريق التي يمشي عليها المشاة.',
                audioPath: 'assets/audio/2_1_1.mp3',
              ),
              HighlightedWord(
                word: 'اشْتَقْنَا',
                image: 'assets/images/words/2_1_2.jpg',
                description: 'شعرنا بالشوق والحنين إلى شيء أو مكان.',
                audioPath: 'assets/audio/2_1_2.mp3',
              ),
            ],
          ),

          Textoo(
            id: 2,
            name: 'في ساحة المدرسة',
            image: 'assets/images/2_2_1.jpg',
            content: '''
فِي سَاحَةِ الْمَدْرَسَةِ  
سَاحَةُ الْمَدْرَسَةِ مُكْتَظَّةٌ بِالتَّلاَمِيذِ، الْحَرَكَةُ فِي كُلِّ مَكَانٍ؛ هَذَا يُسَلِّمُ عَلَى رِفَاقِهِ، وَذَاكَ يَقُصُّ حِكَايَاتِ الْعُطْلَةِ الصَّيْفِيَّةِ، وَآخَرُ يَبْحَثُ عَنْ أَصْدِقَائِهِ.  
وَبَيْنَمَا كُنَّا نَتَحَدَّثُ، دَقَّ الْجَرَسُ، وَتَوَقَّفَتِ الْحَرَكَةُ وَالنَّشَاطُ، وَسَادَ الصَّمْتُ، وَوَقَفْنَا صُفُوفًا مُنْتَظِمَةً، فَرَفَعْنَا الْعَلَمَ وَأَنْشَدْنَا النَّشِيدَ الْوَطَنِيَّ، ثُمَّ تَوَجَّهْنَا نَحْوَ أَقْسَامِنَا، وَكُلُّنَا عَزْمٌ وَاسْتِعْدَادٌ لِلدِّرَاسَةِ.
''',
            highlightedWords: [
              HighlightedWord(
                word: 'مُكْتَظَّةٌ',
                image: 'assets/images/words/2_2_1.jpg',
                description: 'مليئة بالأشخاص حتى امتلأت.',
                audioPath: 'assets/audio/2_2_1.mp3',
              ),
              HighlightedWord(
                word: 'النَّشِيدَ',
                image: 'assets/images/words/2_2_2.jpg',
                description:
                    'أغنية رسمية وطنية تُغنى في الاحتفالات والمناسبات.',
                audioPath: 'assets/audio/2_2_2.mp3',
              ),
            ],
          ),

          Textoo(
            id: 3,
            name: 'في القسم',
            image: 'assets/images/2_3_1.jpg',
            content: '''
فِي الْقِسْمِ  
دَخَلَتِ الْمُعَلِّمَةُ إِلَى الْقِسْمِ بِمِئْزَرِهَا الْأَبْيَضِ النَّاصِعِ مُبْتَسِمَةً، وَقَالَتْ: «السَّلَامُ عَلَيْكُمْ».  
رَدَّ التَّلَامِيذُ: «وَعَلَيْكُمْ السَّلَامُ».  
الْمُعَلِّمَةُ: «هَذَا قِسْمُنَا، سَنَقْضِي فِيهِ عَامًا دِرَاسِيًّا، عَلَيْنَا أَنْ نُزَيِّنَهُ لِيَكُونَ جَمِيلاً».  
رَفَعَ أَمِينُ يَدَهُ وَقَالَ: «هَذِهِ بَاقَةٌ مِنَ الأَزْهَارِ، أَحْضَرْتُهَا لَكِ يَا سَيِّدَتِي».  
الْمُعَلِّمَةُ: «إِنَّهَا جَمِيلَةٌ، سَأَضَعُهَا عَلَى الْمَكْتَبِ».  
لَيْلَى: «وَأَنَا أَحْضَرْتُ مَجْمُوعَةً مِنَ الصُّوَرِ».  
الْمُعَلِّمَةُ: «شُكْرًا لَكُمَا، سَنَتَعَاوَنُ جَمِيعًا عَلَى تَزْيِينِ قِسْمِنَا».
''',
            highlightedWords: [
              HighlightedWord(
                word: 'بِمِئْزَرِهَا',
                image: 'assets/images/words/2_3_1.jpg',
                description: 'رداء واقٍ يُرتدى أثناء العمل أو الدراسة.',
                audioPath: 'assets/audio/2_3_1.mp3',
              ),
              HighlightedWord(
                word: 'النَّاصِعِ',
                image: 'assets/images/words/2_3_2.jpg',
                description: 'لامع ونقي للغاية، مثل اللون الأبيض البراق.',
                audioPath: 'assets/audio/2_3_2.mp3',
              ),
            ],
          ),

          Textoo(
            id: 4,
            name: 'زفاف أختي',
            image: 'assets/images/2_4_1.jpg',
            content: '''
زَفَافُ أُخْتِي  
هَا قَدْ حَلَّ الْيَوْمُ الَّذِي انْتَظَرْنَاهُ، إِنَّهُ الْيَوْمُ الَّذِي تُزَفُّ فِيهِ أُخْتِي عَرُوسًا.  
أَعْدَدْنَا كُلَّ شَيْءٍ، حَضَّرْنَا أَطْبَاقًا كَثِيرَةً مِنَ الْحَلَوِيَّاتِ.  
بَدَأَ الضُّيُوفُ يَلْتَحِقُونَ وَاحِدًا تِلْوَ الآخَرِ، وَمَعَهُمْ الْعَدِيدُ مِنَ الْهَدَايَا.  
قَالَتْ أُمِّي: «هَيَّا يَا سَلْمَى، لِنَسْتَقْبِلْ ضُيُوفَنَا».  
وَفِي الْغَدِ، حَضَرَ مَوْكِبٌ مِنَ السَّيَّارَاتِ، تَقَدَّمَهَا سَيَّارَةٌ مُزَيَّنَةٌ بِالْوُرُودِ، وَخَرَجَتْ أُخْتِي بِفُسْتَانِهَا الْأَبْيَضِ الْجَمِيلِ، تُرَافِقُهَا زَغَارِيدُ النِّسَاءِ وَأَنْغَامُ الْمَزَامِيرِ.  
وَقُلْتُ فِي نَفْسِي: «سَأَشْتَاقُ إِلَيْكِ كَثِيرًا، أَيَّتُهَا الأُخْتُ الْحَبِيبَةُ».
''',
            highlightedWords: [
              HighlightedWord(
                word: 'الضُّيُوفُ',
                image: 'assets/images/words/2_4_1.jpg',
                description: 'الناس الذين يأتون للزيارة أو الاحتفال معنا.',
                audioPath: 'assets/audio/2_4_1.mp3',
              ),
              HighlightedWord(
                word: 'تُزَفُّ',
                image: 'assets/images/words/2_4_2.jpg',
                description:
                    'يُحمل الشخص ويحتفل به احتفالاً خاصاً بمناسبة زواجه.',
                audioPath: 'assets/audio/2_4_2.mp3',
              ),
            ],
          ),

          Textoo(
            id: 5,
            name: 'اليوم ننظف بيتنا',
            image: 'assets/images/2_5_1.jpg',
            content: '''
الْيَوْمَ نُنَظِّفُ بَيْتَنَا  
فِي صَبَاحِ يَوْمِ الْجُمُعَةِ، قَالَتْ أُمِّي: «الْيَوْمَ نُنَظِّفُ بَيْتَنَا».  
سَاعَدْتُ أُمِّي فِي غَسْلِ الْأَوَانِي، وَكَنْسِ الْبَيْتِ، وَتَرْتِيبِ الْأَثَاثِ، وَنَظَّمْنَا الْمَلابِسَ فِي الْخِزَانَةِ.  
أَمَّا أُخْتِي الْكُبْرَى، فَأَخْرَجَتِ الأَفْرِشَةَ وَالزَّرَابِيَّ إِلَى الشُّرْفَةِ.  
وَفِي الْمَسَاءِ، جَاءَتْ صَدِيقَتِي مَرْيَم لِتَلْعَبَ مَعِي، فَقَالَتْ: «مَا أَرْوَعَ بَيْتَكُمْ! نَحْنُ أَيْضًا سَنُنَظِّفُ بَيْتَنَا الأُسْبُوعَ الْقَادِمَ».
''',
            highlightedWords: [
              HighlightedWord(
                word: 'وَكَنْسِ',
                image: 'assets/images/words/2_5_1.jpg',
                description: 'جمع الأتربة والأوساخ باستخدام المكنسة.',
                audioPath: 'assets/audio/2_5_1.mp3',
              ),
              HighlightedWord(
                word: 'الأَفْرِشَةَ',
                image: 'assets/images/words/2_5_2.jpg',
                description: 'الأغطية والفرش التي توضع على الأسرة والأرضيات.',
                audioPath: 'assets/audio/2_5_2.mp3',
              ),
            ],
          ),

          Textoo(
            id: 6,
            name: 'عائلتي تحتفل بالاستقلال',
            image: 'assets/images/2_6_1.jpg',
            content: '''
عَائِلَتِي تَحْتَفِلُ بِالاِسْتِقْلاَلِ  
تَحْكِي الْجَدَّةُ قَائِلَةً: «فِي ذَلِكَ الْيَوْمِ، فَرِحْنَا فَرَحًا عَظِيمًا، خَرَجْنَا إِلَى الشَّوَارِعِ رِجَالًا وَنِسَاءً، نَهْتِفُ بِصَوْتٍ وَاحِدٍ: ‹تَحْيَا الْجَزَائِرُ، تَحْيَا الْجَزَائِرُ›. وَكَانَ الْعَلَمُ الْوَطَنِيُّ يُرْفِرِفُ عَالِيًا فَوْقَ كُلِّ بَيْتٍ».  
قَالَتْ سَلْمَى: «إِذَنْ ذَلِكَ هُوَ الْيَوْمُ الَّذِي اسْتَرْجَعَتْ فِيهِ بِلَادُنَا حُرِّيَّتَهَا وَاسْتِقْلَالَهَا».  
الجَدَّةُ: «نَعَمْ، هَذِهِ مُنَاسَبَةٌ عَظِيمَةٌ، نُحْيِيهَا كُلَّ عَامٍ بِفَخْرٍ وَاعْتِزَازٍ، وَيَبْقَى وَاجِبُكُمْ يَا أَبْنَائِي، الْمُسَاهَمَةُ فِي بِنَاءِ هَذَا الْوَطَنِ وَحِمَايَتِهِ».
''',
            highlightedWords: [
              HighlightedWord(
                word: 'بِالاِسْتِقْلاَلِ',
                image: 'assets/images/words/2_6_1.jpg',
                description: 'تحرير الأمة من السيطرة والاعتماد على النفس.',
                audioPath: 'assets/audio/2_6_1.mp3',
              ),
              HighlightedWord(
                word: 'نَهْتِفُ',
                image: 'assets/images/words/2_6_2.jpg',
                description: 'نرفع أصواتنا بالهتاف والتصفيق في الاحتفالات.',
                audioPath: 'assets/audio/2_6_2.mp3',
              ),
            ],
          ),
        ],
      ),
    ];
  }

  /// تحديد مستوى والانتقال إلى شاشة النصوص
  void selectLevel(int levelId) {
    selectedLevel.value = levelId;
    Get.toNamed('/texts');
  }

  /// البحث داخل النصوص حسب الاسم
  void searchTexts(String query) {
    searchQuery.value = query;
    if (query.isEmpty) {
      searchResults.clear();
      return;
    }

    final List<Textoo> results = [];
    for (final level in levels) {
      for (final text in level.texts) {
        if (text.name.toLowerCase().contains(query.toLowerCase())) {
          results.add(text);
        }
      }
    }
    searchResults.value = results;
  }

  /// مسح بحث النصوص
  void clearSearch() {
    searchQuery.value = '';
    searchResults.clear();
  }
}
